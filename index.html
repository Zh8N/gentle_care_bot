<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>–ë–∞–ª–∞–Ω—Å ‚Äî –¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Telegram WebApp SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
	:root{
	  --bg0: #0b1220;
	  --bg1: #0e1a2b;
	  --card: rgba(255,255,255,.06);
	  --card2: rgba(255,255,255,.08);
	  --stroke: rgba(255,255,255,.10);
	  --text: rgba(255,255,255,.92);
	  --muted: rgba(255,255,255,.70);
	  --muted2: rgba(255,255,255,.55);
	  --good: #34d399; /* emerald-400 */
	  --bad: #fb7185;  /* rose-400 */
	  --accent: #a78bfa; /* violet-400 */
	  --shadow: 0 20px 60px rgba(0,0,0,.35);
	  --radius: 22px;
	  --safe-top: env(safe-area-inset-top, 0px);
	  --safe-bottom: env(safe-area-inset-bottom, 0px);
	}

	/* Subtle grain */
	.grain:before{
	  content:"";
	  position:fixed;
	  inset:0;
	  pointer-events:none;
	  background-image: url("https://source.unsplash.com/1200x800/?paper,texture");
	  opacity:.06;
	  mix-blend-mode: overlay;
	  filter: blur(0.2px) contrast(1.05);
	  z-index:0;
	}

	.glass{
	  background: linear-gradient(180deg, var(--card), rgba(255,255,255,.04));
	  border: 1px solid var(--stroke);
	  box-shadow: var(--shadow);
	  border-radius: var(--radius);
	  backdrop-filter: blur(12px);
	  -webkit-backdrop-filter: blur(12px);
	}

	.soft-ring{
	  box-shadow:
		0 0 0 1px rgba(255,255,255,.08) inset,
		0 16px 40px rgba(0,0,0,.35);
	}

	.btn{
	  border-radius: 18px;
	  border: 1px solid rgba(255,255,255,.12);
	  transition: transform .08s ease, filter .08s ease, background .2s ease;
	}
	.btn:active{
	  transform: translateY(1px) scale(.99);
	  filter: brightness(0.98);
	}

	.pill{
	  border: 1px solid rgba(255,255,255,.12);
	  background: rgba(255,255,255,.05);
	  border-radius: 999px;
	}

	.fade-in{
	  animation: fadeIn .25s ease-out both;
	}
	@keyframes fadeIn{
	  from{ opacity:0; transform: translateY(6px); }
	  to{ opacity:1; transform: translateY(0); }
	}

	/* Nice scrollbar for desktop preview */
	::-webkit-scrollbar{ height: 10px; width: 10px; }
	::-webkit-scrollbar-thumb{ background: rgba(255,255,255,.14); border-radius: 999px; }
	::-webkit-scrollbar-track{ background: rgba(255,255,255,.04); }

	/* Prevent selection to keep "app" feel (still copyable in code area) */
	.no-select{ user-select:none; -webkit-user-select:none; }

	/* Telegram safe areas */
	.safe-top{ padding-top: calc(14px + var(--safe-top)); }
	.safe-bottom{ padding-bottom: calc(14px + var(--safe-bottom)); }
  </style>
</head>

<body class="min-h-screen text-white overflow-x-hidden grain" style="background: radial-gradient(1200px 600px at 30% 10%, rgba(167,139,250,.22), transparent 55%), radial-gradient(900px 500px at 80% 20%, rgba(52,211,153,.14), transparent 60%), linear-gradient(180deg, var(--bg0), var(--bg1)); color: var(--text);">

  <div class="relative z-10 max-w-md mx-auto safe-top safe-bottom px-4 pb-24">
	<!-- Header -->
	<header class="flex items-center justify-between gap-3 mb-4">
	  <div class="flex items-center gap-3">
		<div class="w-10 h-10 rounded-2xl overflow-hidden soft-ring">
		  <img class="w-full h-full object-cover" alt="cover" src="https://source.unsplash.com/200x200/?calm,ocean" />
		</div>
		<div>
		  <div class="text-base font-semibold tracking-tight" id="appTitle">–ë–∞–ª–∞–Ω—Å</div>
		  <div class="text-xs" style="color: var(--muted2);">–¢–∏—Ö–∞—è –≥–∞–≤–∞–Ω—å –¥–ª—è —Ç–≤–æ–∏—Ö –æ—Ç–º–µ—Ç–æ–∫</div>
		</div>
	  </div>

	  <button id="btnTelegram" class="pill px-3 py-2 text-xs flex items-center gap-2 hover:bg-white/10 active:opacity-90">
		<span class="inline-block w-2 h-2 rounded-full bg-white/50" id="tgDot"></span>
		<span id="tgLabel">Web</span>
	  </button>
	</header>

	<!-- Hero card -->
	<section class="glass p-5 mb-4">
	  <div class="flex items-start gap-4">
		<div class="w-12 h-12 rounded-2xl overflow-hidden soft-ring">
		  <img class="w-full h-full object-cover" alt="avatar" src="https://source.unsplash.com/200x200/?soft,portrait" />
		</div>
		<div class="flex-1">
		  <h1 class="text-lg font-semibold leading-tight mb-2">–ü—Ä–∏–≤–µ—Ç. –Ø —Ä—è–¥–æ–º üåø</h1>
		  <p class="text-sm leading-relaxed" style="color: var(--muted);">
			–ë–µ–∑ –æ—Ü–µ–Ω–æ–∫, –±–µ–∑ –≤–∏–Ω—ã –∏ –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è.
			–ï—Å–ª–∏ —Å–¥–µ–ª–∞–µ—à—å —á—Ç–æ-—Ç–æ –ø–æ–ª–µ–∑–Ω–æ–µ –¥–ª—è —Å–µ–±—è ‚Äî –Ω–∞–∂–º–∏ <span class="font-semibold" style="color: var(--good);">–∑–µ–ª—ë–Ω—É—é</span>.
			–ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ —Å–≤–µ—Ä–Ω—É–ª(–∞) –Ω–µ —Ç—É–¥–∞ ‚Äî –Ω–∞–∂–º–∏ <span class="font-semibold" style="color: var(--bad);">–∫—Ä–∞—Å–Ω—É—é</span>.
			–Ø –≤—Å—ë –±–µ—Ä–µ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—é.
		  </p>

		  <div class="flex flex-wrap gap-2 mt-3">
			<span class="pill px-3 py-1 text-xs" style="color: var(--muted);">ü´∂ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ</span>
			<span class="pill px-3 py-1 text-xs" style="color: var(--muted);">üß† –º–µ–Ω—å—à–µ —Ç—Ä–µ–≤–æ–≥–∏</span>
			<span class="pill px-3 py-1 text-xs" style="color: var(--muted);">üåô –∏—Ç–æ–≥–∏ –¥–Ω—è –∏ –Ω–µ–¥–µ–ª–∏</span>
		  </div>
		</div>
	  </div>
	</section>

	<!-- Tabs -->
	<nav class="flex gap-2 mb-3 no-select">
	  <button data-tab="log" class="tab btn px-4 py-2 text-sm bg-white/10">–û—Ç–º–µ—Ç–∫–∏</button>
	  <button data-tab="summary" class="tab btn px-4 py-2 text-sm bg-white/5">–ò—Ç–æ–≥–∏</button>
	  <button data-tab="settings" class="tab btn px-4 py-2 text-sm bg-white/5">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
	</nav>

	<!-- Content -->
	<main>
	  <!-- Log tab -->
	  <section id="tab-log" class="fade-in">
		<div class="grid grid-cols-1 gap-3">

		  <!-- Big buttons -->
		  <div class="glass p-4">
			<div class="flex items-center justify-between mb-3">
			  <div>
				<div class="text-sm font-semibold">–û—Ç–º–µ—Ç–∏—Ç—å –º–æ–º–µ–Ω—Ç</div>
				<div class="text-xs" style="color: var(--muted2);">–≠—Ç–æ –∑–∞–π–º—ë—Ç —Å–µ–∫—É–Ω–¥—É ‚Äî –∏ –¥–∞—Å—Ç —è—Å–Ω–æ—Å—Ç—å</div>
			  </div>
			  <div class="pill px-3 py-1 text-xs" id="todayBalancePill">–°–µ–≥–æ–¥–Ω—è: ‚Ä¶</div>
			</div>

			<div class="grid grid-cols-2 gap-3">
			  <button id="btnGood" class="btn p-4 text-left bg-emerald-400/15 hover:bg-emerald-400/20">
				<div class="text-2xl mb-1">üü¢</div>
				<div class="font-semibold">–í –∫–æ–ø–∏–ª–∫—É</div>
				<div class="text-xs mt-1" style="color: var(--muted);">–∑–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ</div>
			  </button>

			  <button id="btnBad" class="btn p-4 text-left bg-rose-400/15 hover:bg-rose-400/20">
				<div class="text-2xl mb-1">üî¥</div>
				<div class="font-semibold">–ù–∞ –ø–∞—É–∑–µ</div>
				<div class="text-xs mt-1" style="color: var(--muted);">—à–∞–≥ –≤ —Å—Ç–æ—Ä–æ–Ω—É</div>
			  </button>
			</div>

			<div class="mt-3 flex items-center justify-between gap-3">
			  <div class="text-xs" style="color: var(--muted2);" id="microCopy">–î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º? –¢–≤–æ–π –±–∞–ª–∞–Ω—Å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.</div>
			  <button id="btnUndo" class="pill px-3 py-2 text-xs hover:bg-white/10 active:opacity-90">
				–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é
			  </button>
			</div>
		  </div>

		  <!-- Pattern -->
		  <div class="glass p-4">
			<div class="flex items-center justify-between mb-2">
			  <div class="text-sm font-semibold">–¢–≤–æ–π —É–∑–æ—Ä —Å–µ–≥–æ–¥–Ω—è</div>
			  <button id="btnClearToday" class="pill px-3 py-2 text-xs hover:bg-white/10 active:opacity-90">–û—á–∏—Å—Ç–∏—Ç—å –¥–µ–Ω—å</button>
			</div>

			<div id="patternRow" class="flex flex-wrap gap-2 text-xl leading-none min-h-[40px]"></div>

			<div class="mt-3 text-xs leading-relaxed" style="color: var(--muted);">
			  –¢—É—Ç –Ω–µ—Ç ‚Äú–ø–ª–æ—Ö–æ/—Ö–æ—Ä–æ—à–æ‚Äù. –ï—Å—Ç—å —á–µ—Å—Ç–Ω–æ—Å—Ç—å. –ò –æ–Ω–∞ —É–∂–µ –ø–æ–º–æ–≥–∞–µ—Ç üíõ
			</div>
		  </div>

		  <!-- Notes (optional) -->
		  <div class="glass p-4">
			<div class="flex items-center justify-between mb-2">
			  <div class="text-sm font-semibold">–ù–µ–∂–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</div>
			  <span class="text-xs" style="color: var(--muted2);" id="noteHint">–¥–ª—è —Å–µ–±—è, –≤ –ø–∞—Ä—É —Å–ª–æ–≤</span>
			</div>
			<textarea id="noteInput" rows="3"
			  class="w-full rounded-2xl p-3 bg-white/5 border border-white/10 outline-none focus:border-white/20 text-sm"
			  placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ‚Äú—Å–¥–µ–ª–∞–ª–∞ –ø–∞—É–∑—É, –≤—ã–ø–∏–ª–∞ –≤–æ–¥—ã, –≤—ã—à–ª–∞ –Ω–∞ –≤–æ–∑–¥—É—Ö‚Äù‚Ä¶"></textarea>
			<div class="mt-2 flex items-center justify-between">
			  <button id="btnSaveNote" class="btn px-4 py-2 text-sm bg-white/10 hover:bg-white/15">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É</button>
			  <div class="text-xs" style="color: var(--muted2);" id="noteSavedAt"></div>
			</div>
		  </div>

		</div>
	  </section>

	  <!-- Summary tab -->
	  <section id="tab-summary" class="hidden fade-in">
		<div class="grid gap-3">

		  <div class="glass p-4">
			<div class="flex items-center justify-between mb-2">
			  <div>
				<div class="text-sm font-semibold">üåô –ò—Ç–æ–≥–∏ –¥–Ω—è</div>
				<div class="text-xs" style="color: var(--muted2);">–ø–æ —Ç–µ–∫—É—â–µ–º—É –¥–Ω—é</div>
			  </div>
			  <button id="btnGenerateDaily" class="btn px-4 py-2 text-sm bg-white/10 hover:bg-white/15">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
			</div>

			<pre id="dailyText" class="whitespace-pre-wrap text-sm leading-relaxed bg-white/5 border border-white/10 rounded-2xl p-3 min-h-[96px]" style="color: var(--text);"></pre>

			<div class="mt-2 flex items-center justify-between gap-2">
			  <button id="btnSendDaily" class="pill px-3 py-2 text-xs hover:bg-white/10 active:opacity-90">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç</button>
			  <span class="text-xs" style="color: var(--muted2);">–±–æ—Ç –º–æ–∂–µ—Ç –ø—Ä–∏—Å–ª–∞—Ç—å —ç—Ç–æ —Ç–µ–±–µ –≤ —á–∞—Ç</span>
			</div>
		  </div>

		  <div class="glass p-4">
			<div class="flex items-center justify-between mb-2">
			  <div>
				<div class="text-sm font-semibold">‚ú® –¢–≤–æ—è –Ω–µ–¥–µ–ª—è</div>
				<div class="text-xs" style="color: var(--muted2);">–ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</div>
			  </div>
			  <button id="btnGenerateWeekly" class="btn px-4 py-2 text-sm bg-white/10 hover:bg-white/15">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</button>
			</div>

			<pre id="weeklyText" class="whitespace-pre-wrap text-sm leading-relaxed bg-white/5 border border-white/10 rounded-2xl p-3 min-h-[140px]" style="color: var(--text);"></pre>

			<div class="mt-2 flex items-center justify-between gap-2">
			  <button id="btnSendWeekly" class="pill px-3 py-2 text-xs hover:bg-white/10 active:opacity-90">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç</button>
			  <span class="text-xs" style="color: var(--muted2);">–∞ –±–æ—Ç ‚Äî –ø—Ä–∏—à–ª—ë—Ç –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º</span>
			</div>
		  </div>

		  <div class="glass p-4">
			<div class="text-sm font-semibold mb-2">–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
			<ul class="text-sm leading-relaxed list-disc pl-5" style="color: var(--muted);">
			  <li>–û—Ç–º–µ—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è <b>–ª–æ–∫–∞–ª—å–Ω–æ</b> (–≤ Telegram ‚Äî –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ).</li>
			  <li>–ù–∞–∂–º—ë—à—å ‚Äú–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç‚Äù ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—Å—Ç JSON —á–µ—Ä–µ–∑ <code>sendData</code>.</li>
			  <li>–î–∞–ª—å—à–µ –±–æ—Ç –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —ç—Ç–æ –≤ –±–∞–∑–µ –∏ –ø—Ä–∏—Å—ã–ª–∞—Ç—å —Å–≤–æ–¥–∫–∏ <b>–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</b>.</li>
			</ul>
		  </div>

		</div>
	  </section>

	  <!-- Settings tab -->
	  <section id="tab-settings" class="hidden fade-in">
		<div class="grid gap-3">
		  <div class="glass p-4">
			<div class="text-sm font-semibold mb-2">–ù–∞–∑–≤–∞–Ω–∏–µ –∏ —Ç–æ–Ω</div>
			<div class="grid gap-2">
			  <label class="text-xs" style="color: var(--muted2);">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
			  <input id="titleInput" class="w-full rounded-2xl p-3 bg-white/5 border border-white/10 outline-none focus:border-white/20 text-sm" placeholder="–ë–∞–ª–∞–Ω—Å / –¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å" />
			  <div class="flex gap-2">
				<button id="btnSetBalance" class="btn px-4 py-2 text-sm bg-white/10 hover:bg-white/15">–ë–∞–ª–∞–Ω—Å</button>
				<button id="btnSetHarbor" class="btn px-4 py-2 text-sm bg-white/10 hover:bg-white/15">–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</button>
			  </div>
			  <div class="text-xs" style="color: var(--muted2);">
				–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ–≤–æ—Ä–∏—Ç –º—è–≥–∫–æ –∏ –∫–æ—Ä–æ—Ç–∫–æ ‚Äî —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å, –∞ –Ω–µ –æ—Ç–≤–ª–µ–∫–∞—Ç—å.
			  </div>
			</div>
		  </div>

		  <div class="glass p-4">
			<div class="text-sm font-semibold mb-2">–î–∞–Ω–Ω—ã–µ</div>
			<div class="text-sm" style="color: var(--muted);">
			  –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞ ‚Äî –º–æ–∂–Ω–æ —Å—Ç–µ—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é (—ç—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å—ë –ª–æ–∫–∞–ª—å–Ω–æ).
			</div>
			<div class="mt-3 flex gap-2">
			  <button id="btnExport" class="btn px-4 py-2 text-sm bg-white/10 hover:bg-white/15">–≠–∫—Å–ø–æ—Ä—Ç JSON</button>
			  <button id="btnReset" class="btn px-4 py-2 text-sm bg-rose-400/20 hover:bg-rose-400/25">–°—Ç–µ—Ä–µ—Ç—å –≤—Å—ë</button>
			</div>
			<pre id="exportBox" class="mt-3 hidden whitespace-pre-wrap text-xs leading-relaxed bg-white/5 border border-white/10 rounded-2xl p-3"></pre>
		  </div>

		  <div class="glass p-4">
			<div class="text-sm font-semibold mb-2">–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–ª—è BotFather</div>
			<div class="text-sm" style="color: var(--muted);">
			  URL Web App –±—É–¥–µ—Ç —Ç–≤–æ–µ–π —Å—Å—ã–ª–∫–æ–π GitHub Pages (–º—ã —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ –Ω–∞ –≠–¢–ê–ü–ï 3).
			</div>
			<div class="mt-2 text-xs" style="color: var(--muted2);">
			  –ê —á—Ç–æ–±—ã –±–æ—Ç —Å–ª–∞–ª –∏—Ç–æ–≥–∏ –≤ 21:00 –∏ –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º ‚Äî –Ω—É–∂–µ–Ω –Ω–µ–±–æ–ª—å—à–æ–π backend/–±–æ—Ç-—Å–∫—Ä–∏–ø—Ç (—è –º–æ–≥—É –Ω–∞–∫–∏–¥–∞—Ç—å –∏ –µ–≥–æ, –∫–æ–≥–¥–∞ —Å–∫–∞–∂–µ—à—å).
			</div>
		  </div>
		</div>
	  </section>
	</main>

	<!-- Bottom persistent bar -->
	<footer class="fixed left-0 right-0 bottom-0 z-20">
	  <div class="max-w-md mx-auto px-4 pb-[calc(10px+var(--safe-bottom))]">
		<div class="glass px-3 py-3 flex items-center justify-between gap-2">
		  <button class="btn px-4 py-3 text-sm bg-emerald-400/15 hover:bg-emerald-400/20 flex-1" id="quickGood">
			üü¢ –í –∫–æ–ø–∏–ª–∫—É
		  </button>
		  <button class="btn px-4 py-3 text-sm bg-rose-400/15 hover:bg-rose-400/20 flex-1" id="quickBad">
			üî¥ –ù–∞ –ø–∞—É–∑–µ
		  </button>
		  <button class="pill px-3 py-3 text-sm hover:bg-white/10" id="quickHome" title="–í–≤–µ—Ä—Ö">
			‚§¥Ô∏é
		  </button>
		</div>
	  </div>
	</footer>

	<!-- Toast -->
	<div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-24 z-30 hidden">
	  <div class="glass px-4 py-3 text-sm max-w-md">
		<div class="flex items-start gap-3">
		  <div class="text-xl" id="toastIcon">üåø</div>
		  <div class="flex-1">
			<div class="font-semibold" id="toastTitle">–ó–∞–ø–∏—Å–∞–ª–∞.</div>
			<div class="text-xs mt-0.5" style="color: var(--muted);" id="toastBody">–≠—Ç–æ —Ü–µ–Ω–Ω–æ.</div>
		  </div>
		  <button class="pill px-3 py-2 text-xs hover:bg-white/10" id="toastClose">–û–∫</button>
		</div>
	  </div>
	</div>
  </div>

  <script>
	;(() => {
	  // -----------------------------
	  // Storage model
	  // -----------------------------
	  const STORAGE_KEY = "balance_twa_v1";
	  const todayKey = () => new Date().toISOString().slice(0,10); // YYYY-MM-DD (local-ish, but good enough for UI)
	  const nowISO = () => new Date().toISOString();

	  const defaultState = () => ({
		title: "–ë–∞–ª–∞–Ω—Å",
		note: { text: "", savedAt: null },
		events: [
		  // { ts: ISO, date: YYYY-MM-DD, type: "good"|"bad" }
		],
		lastSent: { daily: null, weekly: null }
	  });

	  function loadState(){
		try{
		  const raw = localStorage.getItem(STORAGE_KEY);
		  if(!raw) return defaultState();
		  const parsed = JSON.parse(raw);
		  return { ...defaultState(), ...parsed };
		}catch(e){
		  return defaultState();
		}
	  }

	  function saveState(){
		localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
	  }

	  let state = loadState();

	  // -----------------------------
	  // Copy tone lists
	  // -----------------------------
	  const goodReplies = [
		"–ó–∞–ø–∏—Å–∞–ª–∞. –≠—Ç–æ —Ü–µ–Ω–Ω–æ.",
		"–°–≤–µ—Ç–ª—ã–π –º–æ–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω.",
		"–í –∫–æ–ø–∏–ª–∫—É —Ç–≤–æ–µ–π —Å–∏–ª—ã.",
		"–û—Ç–ª–∏—á–Ω–æ, —à–∞–≥ –∑–∞—Å—á–∏—Ç–∞–Ω."
	  ];

	  const badReplies = [
		"–Ø —Ä—è–¥–æ–º. –ü—Ä–æ—Å—Ç–æ –æ—Ç–º–µ—Ç–∏–º —ç—Ç–æ.",
		"–ü—Ä–∏–Ω—è—Ç–æ. –î—ã—à–∏ –≥–ª—É–±–∂–µ.",
		"–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ —á–∞—Å—Ç—å –ø—É—Ç–∏. –ò–¥—ë–º –¥–∞–ª—å—à–µ.",
		"–£—á—Ç–µ–Ω–æ. –í—Å—ë –ø–æ–ø—Ä–∞–≤–∏–º–æ."
	  ];

	  // -----------------------------
	  // Telegram integration (optional)
	  // -----------------------------
	  let tg = null;
	  function initTelegram(){
		try{
		  if(window.Telegram && window.Telegram.WebApp){
			tg = window.Telegram.WebApp;
			tg.ready?.();
			tg.expand?.();

			// Apply Telegram theme if available
			const tp = tg.themeParams || {};
			// Use safe mapping, keep aesthetics
			const bg = tp.bg_color || null;
			const text = tp.text_color || null;
			const hint = tp.hint_color || null;
			const accent = tp.button_color || null;

			// Minimal theme adaptation: if Telegram provides light theme bg, switch to lighter surfaces
			if(bg && isLight(bg)){
			  document.documentElement.style.setProperty("--bg0", "#f6f7fb");
			  document.documentElement.style.setProperty("--bg1", "#eef1f8");
			  document.documentElement.style.setProperty("--card", "rgba(0,0,0,.045)");
			  document.documentElement.style.setProperty("--card2", "rgba(0,0,0,.06)");
			  document.documentElement.style.setProperty("--stroke", "rgba(0,0,0,.08)");
			  document.documentElement.style.setProperty("--text", "rgba(10,15,25,.92)");
			  document.documentElement.style.setProperty("--muted", "rgba(10,15,25,.72)");
			  document.documentElement.style.setProperty("--muted2", "rgba(10,15,25,.55)");
			  document.body.classList.remove("text-white");
			}

			if(text) document.documentElement.style.setProperty("--text", hexToRgba(text, .92));
			if(hint) {
			  document.documentElement.style.setProperty("--muted", hexToRgba(hint, .90));
			  document.documentElement.style.setProperty("--muted2", hexToRgba(hint, .75));
			}
			if(accent) document.documentElement.style.setProperty("--accent", accent);

			// Update UI badge
			$("#tgDot").className = "inline-block w-2 h-2 rounded-full bg-emerald-400";
			$("#tgLabel").textContent = "Telegram";

			// Haptic on taps if available
		  } else {
			$("#tgDot").className = "inline-block w-2 h-2 rounded-full bg-white/50";
			$("#tgLabel").textContent = "Web";
		  }
		}catch(e){
		  // ignore
		}
	  }

	  // Helpers for theme
	  function isLight(hex){
		try{
		  const {r,g,b} = hexToRgb(hex);
		  // Perceived luminance
		  const lum = (0.2126*r + 0.7152*g + 0.0722*b) / 255;
		  return lum > 0.6;
		}catch(e){ return false; }
	  }
	  function hexToRgb(hex){
		const h = hex.replace("#","").trim();
		const full = h.length === 3 ? h.split("").map(x=>x+x).join("") : h;
		const n = parseInt(full, 16);
		return { r: (n>>16)&255, g: (n>>8)&255, b: n&255 };
	  }
	  function hexToRgba(hex, a){
		const {r,g,b} = hexToRgb(hex);
		return `rgba(${r},${g},${b},${a})`;
	  }

	  // -----------------------------
	  // DOM helpers
	  // -----------------------------
	  function $(sel){ return document.querySelector(sel); }
	  function $all(sel){ return Array.from(document.querySelectorAll(sel)); }

	  function pick(arr){
		return arr[Math.floor(Math.random() * arr.length)];
	  }

	  function toast(icon, title, body){
		$("#toastIcon").textContent = icon;
		$("#toastTitle").textContent = title;
		$("#toastBody").textContent = body;

		$("#toast").classList.remove("hidden");
		$("#toast").classList.add("fade-in");

		// Auto-hide
		window.clearTimeout(toast._t);
		toast._t = window.setTimeout(() => {
		  $("#toast").classList.add("hidden");
		}, 2200);
	  }

	  function haptic(kind="light"){
		try{
		  if(tg && tg.HapticFeedback){
			if(kind === "success") tg.HapticFeedback.notificationOccurred("success");
			else if(kind === "error") tg.HapticFeedback.notificationOccurred("error");
			else tg.HapticFeedback.impactOccurred("light");
		  }
		}catch(e){}
	  }

	  // -----------------------------
	  // Data operations
	  // -----------------------------
	  function addEvent(type){
		const d = todayKey();
		state.events.push({ ts: nowISO(), date: d, type });
		saveState();

		const reply = (type === "good") ? pick(goodReplies) : pick(badReplies);
		const icon  = (type === "good") ? "üü¢" : "üî¥";
		toast(icon, "–ó–∞–ø–∏—Å–∞–ª–∞.", reply);

		haptic(type === "good" ? "success" : "light");

		renderAll();
	  }

	  function undoLast(){
		if(state.events.length === 0){
		  toast("ü´ß", "–ù–µ—á–µ–≥–æ –æ—Ç–º–µ–Ω—è—Ç—å", "–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–º–µ—Ç–æ–∫ ‚Äî –∏ —ç—Ç–æ —Ç–æ–∂–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.");
		  haptic("light");
		  return;
		}
		const last = state.events[state.events.length - 1];
		state.events.pop();
		saveState();
		toast("‚Ü©Ô∏è", "–û—Ç–º–µ–Ω–µ–Ω–æ", last.type === "good" ? "–ó–µ–ª—ë–Ω—É—é –æ—Ç–º–µ—Ç–∫—É —É–±—Ä–∞–ª–∞." : "–ö—Ä–∞—Å–Ω—É—é –æ—Ç–º–µ—Ç–∫—É —É–±—Ä–∞–ª–∞.");
		haptic("light");
		renderAll();
	  }

	  function clearToday(){
		const d = todayKey();
		const before = state.events.length;
		state.events = state.events.filter(e => e.date !== d);
		const removed = before - state.events.length;
		saveState();
		toast("üßπ", "–û—á–∏—â–µ–Ω–æ", removed ? "–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–µ –æ—Ç–º–µ—Ç–∫–∏ —É–±—Ä–∞–Ω—ã. –ù–æ–≤—ã–π –ª–∏—Å—Ç ‚Äî –º—è–≥–∫–æ." : "–°–µ–≥–æ–¥–Ω—è –µ—â—ë –Ω–µ –±—ã–ª–æ –æ—Ç–º–µ—Ç–æ–∫.");
		haptic("light");
		renderAll();
	  }

	  function saveNote(){
		const text = ($("#noteInput").value || "").trim();
		state.note = { text, savedAt: text ? nowISO() : null };
		saveState();
		toast("üìù", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ", text ? "–ù–µ–∂–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π." : "–ó–∞–º–µ—Ç–∫–∞ –æ—á–∏—â–µ–Ω–∞.");
		haptic("success");
		renderAll();
	  }

	  function countForDate(d){
		const events = state.events.filter(e => e.date === d);
		const g = events.filter(e => e.type === "good").length;
		const r = events.filter(e => e.type === "bad").length;
		return { g, r, total: events.length, events };
	  }

	  function lastNDaysKeys(n){
		const out = [];
		const t = new Date();
		// Use local date keys
		for(let i=0; i<n; i++){
		  const d = new Date(t);
		  d.setDate(t.getDate() - i);
		  out.push(d.toISOString().slice(0,10));
		}
		return out.reverse();
	  }

	  function generateDailyText(){
		const d = todayKey();
		const { g, r, events } = countForDate(d);

		if(events.length === 0){
		  return `üåô –¢–∏—Ö–∏–π –¥–µ–Ω—å
–°–µ–≥–æ–¥–Ω—è —Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –æ—Ç–º–µ—á–∞–ª(–∞). –ù–∞–¥–µ—é—Å—å, —É —Ç–µ–±—è –≤—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ.
–ï—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–ø–∏—Å—è–º ‚Äî —è –∑–¥–µ—Å—å, –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ —Ä—É–∫–æ–π.
–î–æ–±—Ä–æ–π –Ω–æ—á–∏.`;
		}

		const pattern = events.map(e => e.type === "good" ? "üü¢" : "üî¥").join("");
		const balance = g - r;

		if(balance > 0){
		  return `üåô –ò—Ç–æ–≥–∏ –¥–Ω—è
–¢–≤–æ–π —É–∑–æ—Ä —Å–µ–≥–æ–¥–Ω—è:
${pattern}
–ë–∞–ª–∞–Ω—Å: +${balance} –≤ —Ç–≤–æ—é –ø–æ–ª—å–∑—É.

–°–µ–≥–æ–¥–Ω—è —Ç—ã –º–Ω–æ–≥–æ —Å–¥–µ–ª–∞–ª(–∞) –¥–ª—è —Å–µ–±—è. –ü—É—Å—Ç—å —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ —Ç–µ–ø–ª–∞ –æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Å —Ç–æ–±–æ–π –¥–æ —É—Ç—Ä–∞. –û—Ç–¥—ã—Ö–∞–π.`;
		} else {
		  return `üåô –ò—Ç–æ–≥–∏ –¥–Ω—è
–¢–≤–æ–π —É–∑–æ—Ä —Å–µ–≥–æ–¥–Ω—è:
${pattern}
–ë–∞–ª–∞–Ω—Å: ${balance}.

–î–µ–Ω—å –±—ã–ª –Ω–µ–ø—Ä–æ—Å—Ç—ã–º, –Ω–æ —Ç—ã —á–µ—Å—Ç–µ–Ω(–Ω–∞) —Å —Å–æ–±–æ–π, –∏ —ç—Ç–æ –≥–ª–∞–≤–Ω–æ–µ. –ó–∞–≤—Ç—Ä–∞ –±—É–¥–µ—Ç –Ω–æ–≤—ã–π –ª–∏—Å—Ç –∏ –Ω–æ–≤—ã–µ —Å–∏–ª—ã. –Ø –±—É–¥—É –∂–¥–∞—Ç—å —Ç–µ–±—è —Ç–∞–º.`;
		}
	  }

	  function generateWeeklyText(){
		const days = lastNDaysKeys(7);
		let gSum = 0, rSum = 0;

		const lines = days.map(d => {
		  const { g, r, events } = countForDate(d);
		  gSum += g; rSum += r;

		  if(events.length === 0) return `${fmtDay(d)}: ‚Äî`;
		  const pattern = events.map(e => e.type === "good" ? "üü¢" : "üî¥").join("");
		  return `${fmtDay(d)}: ${pattern}`;
		});

		const balance = gSum - rSum;

		const header = `‚ú® –¢–≤–æ—è –Ω–µ–¥–µ–ª—è
–î–∞–≤–∞–π –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ —ç—Ç–æ –±—ã–ª–æ.
–ü–æ–ª–µ–∑–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π: ${gSum} üåø
–ú–æ–º–µ–Ω—Ç–æ–≤ "–Ω–∞ –ø–∞—É–∑–µ": ${rSum} üçÇ
–û–±—â–∏–π –±–∞–ª–∞–Ω—Å: ${balance >= 0 ? "+"+balance : balance}

–ì—Ä–∞—Ñ–∏–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è:
${lines.join("\n")}`;

		const footer = (balance >= 0)
		  ? `\n\n–¢–≤–æ—è –Ω–µ–¥–µ–ª—è –±—ã–ª–∞ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∞ –∑–∞–±–æ—Ç–æ–π –æ —Å–µ–±–µ. –≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å—Ç—Ä–æ–∏—Ç—Å—è –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ. –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –¥–æ–≤–µ—Ä—è–µ—à—å –º–Ω–µ —ç—Ç–æ—Ç –ø—É—Ç—å.`
		  : `\n\n–ù–µ–¥–µ–ª—è –ø—Ä–∏–Ω–µ—Å–ª–∞ —Å–≤–æ–∏ —É—Ä–æ–∫–∏. –ü–æ–º–Ω–∏, —á—Ç–æ —Ä–æ—Å—Ç –Ω–µ –≤—Å–µ–≥–¥–∞ –∏–¥—ë—Ç –ø–æ –ø—Ä—è–º–æ–π –ª–∏–Ω–∏–∏. –í–∞–∂–Ω–æ, —á—Ç–æ —Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞–µ—à—å –Ω–∞–±–ª—é–¥–∞—Ç—å. –° –Ω–æ–≤–æ–π –Ω–µ–¥–µ–ª–∏ –Ω–∞—á–Ω—ë–º —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞. ‚ú®`;

		return header + footer;
	  }

	  function fmtDay(isoDate){
		// isoDate: YYYY-MM-DD
		const d = new Date(isoDate + "T00:00:00");
		const map = ["–í—Å","–ü–Ω","–í—Ç","–°—Ä","–ß—Ç","–ü—Ç","–°–±"];
		return map[d.getDay()];
	  }

	  // -----------------------------
	  // Send data to bot
	  // -----------------------------
	  function sendToBot(kind, text){
		const payload = {
		  kind, // "daily" | "weekly"
		  text,
		  title: state.title,
		  date: todayKey(),
		  ts: nowISO(),
		  // minimal stats for bot
		  stats: kind === "daily" ? countForDate(todayKey()) : null
		};

		if(tg && tg.sendData){
		  tg.sendData(JSON.stringify(payload));
		  toast("üì®", "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ", "–Ø –æ—Ç–¥–∞–ª–∞ —ç—Ç–æ –±–æ—Ç—É. –û–Ω –º–æ–∂–µ—Ç –ø—Ä–∏—Å–ª–∞—Ç—å —Ç–µ–±–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç.");
		  haptic("success");
		} else {
		  // fallback: copy to clipboard
		  navigator.clipboard?.writeText(text).catch(()=>{});
		  toast("üìã", "–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ", "–û—Ç–∫—Ä–æ–π Telegram –∏ –≤—Å—Ç–∞–≤—å –≤ —á–∞—Ç ‚Äî –µ—Å–ª–∏ —Ö–æ—á–µ—à—å.");
		  haptic("light");
		}

		state.lastSent[kind] = payload.ts;
		saveState();
	  }

	  // -----------------------------
	  // Rendering
	  // -----------------------------
	  function renderTitle(){
		$("#appTitle").textContent = state.title || "–ë–∞–ª–∞–Ω—Å";
		$("#titleInput").value = state.title || "";
	  }

	  function renderPattern(){
		const { events } = countForDate(todayKey());
		const row = $("#patternRow");
		row.innerHTML = "";

		if(events.length === 0){
		  const empty = document.createElement("div");
		  empty.className = "text-sm";
		  empty.style.color = "var(--muted2)";
		  empty.textContent = "–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –ò —ç—Ç–æ –Ω–µ –ø–æ–≤–æ–¥ –¥–∞–≤–∏—Ç—å –Ω–∞ —Å–µ–±—è.";
		  row.appendChild(empty);
		  return;
		}

		events.slice(-36).forEach(e => {
		  const span = document.createElement("span");
		  span.textContent = e.type === "good" ? "üü¢" : "üî¥";
		  span.className = "text-2xl";
		  row.appendChild(span);
		});
	  }

	  function renderTodayBalance(){
		const { g, r } = countForDate(todayKey());
		const bal = g - r;

		const pill = $("#todayBalancePill");
		const label = (g + r) === 0
		  ? "–°–µ–≥–æ–¥–Ω—è: —Ç–∏—Ö–æ"
		  : `–°–µ–≥–æ–¥–Ω—è: ${bal >= 0 ? "+"+bal : bal} (${g}üü¢ / ${r}üî¥)`;

		pill.textContent = label;

		if((g + r) === 0){
		  pill.style.color = "var(--muted)";
		  pill.style.borderColor = "rgba(255,255,255,.12)";
		  pill.style.background = "rgba(255,255,255,.05)";
		} else if(bal >= 0){
		  pill.style.color = "rgba(52,211,153,.95)";
		  pill.style.borderColor = "rgba(52,211,153,.25)";
		  pill.style.background = "rgba(52,211,153,.10)";
		} else {
		  pill.style.color = "rgba(251,113,133,.95)";
		  pill.style.borderColor = "rgba(251,113,133,.25)";
		  pill.style.background = "rgba(251,113,133,.10)";
		}
	  }

	  function renderNote(){
		$("#noteInput").value = state.note?.text || "";
		const savedAt = state.note?.savedAt;
		$("#noteSavedAt").textContent = savedAt ? `–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ: ${new Date(savedAt).toLocaleString()}` : "";
	  }

	  function renderSummaries(){
		// keep text boxes populated with latest generation (but don't overwrite if user edited? we keep simple)
		if(!$("#dailyText").textContent.trim()){
		  $("#dailyText").textContent = generateDailyText();
		}
		if(!$("#weeklyText").textContent.trim()){
		  $("#weeklyText").textContent = generateWeeklyText();
		}
	  }

	  function renderAll(){
		renderTitle();
		renderPattern();
		renderTodayBalance();
		renderNote();
		renderSummaries();
	  }

	  // -----------------------------
	  // Tabs
	  // -----------------------------
	  function setTab(name){
		$all(".tab").forEach(btn => {
		  const active = btn.dataset.tab === name;
		  btn.classList.toggle("bg-white/10", active);
		  btn.classList.toggle("bg-white/5", !active);
		});

		$("#tab-log").classList.toggle("hidden", name !== "log");
		$("#tab-summary").classList.toggle("hidden", name !== "summary");
		$("#tab-settings").classList.toggle("hidden", name !== "settings");
	  }

	  // -----------------------------
	  // Events
	  // -----------------------------
	  function wireEvents(){
		$("#btnGood").addEventListener("click", () => addEvent("good"));
		$("#btnBad").addEventListener("click", () => addEvent("bad"));
		$("#quickGood").addEventListener("click", () => addEvent("good"));
		$("#quickBad").addEventListener("click", () => addEvent("bad"));

		$("#btnUndo").addEventListener("click", undoLast);
		$("#btnClearToday").addEventListener("click", clearToday);

		$("#btnSaveNote").addEventListener("click", saveNote);

		$all(".tab").forEach(btn => btn.addEventListener("click", () => setTab(btn.dataset.tab)));

		$("#quickHome").addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));

		$("#toastClose").addEventListener("click", () => $("#toast").classList.add("hidden"));

		$("#btnGenerateDaily").addEventListener("click", () => {
		  $("#dailyText").textContent = generateDailyText();
		  toast("üåô", "–ì–æ—Ç–æ–≤–æ", "–ò—Ç–æ–≥–∏ –¥–Ω—è —Å–æ–±—Ä–∞–Ω—ã –º—è–≥–∫–æ –∏ —á–µ—Å—Ç–Ω–æ.");
		  haptic("success");
		});

		$("#btnGenerateWeekly").addEventListener("click", () => {
		  $("#weeklyText").textContent = generateWeeklyText();
		  toast("‚ú®", "–ì–æ—Ç–æ–≤–æ", "–ù–µ–¥–µ–ª—è —Å—Ç–∞–ª–∞ —è—Å–Ω–µ–µ ‚Äî –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è.");
		  haptic("success");
		});

		$("#btnSendDaily").addEventListener("click", () => sendToBot("daily", $("#dailyText").textContent));
		$("#btnSendWeekly").addEventListener("click", () => sendToBot("weekly", $("#weeklyText").textContent));

		$("#btnSetBalance").addEventListener("click", () => {
		  state.title = "–ë–∞–ª–∞–Ω—Å";
		  saveState();
		  renderTitle();
		  toast("ü™û", "–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ", "–ü—É—Å—Ç—å —ç—Ç–æ –±—É–¥–µ—Ç —Ç–≤–æ–µ–π —Å–ø–æ–∫–æ–π–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.");
		  haptic("light");
		});

		$("#btnSetHarbor").addEventListener("click", () => {
		  state.title = "–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å";
		  saveState();
		  renderTitle();
		  toast("‚öìÔ∏è", "–ù–∞–∑–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ", "–ú–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è —Å—é–¥–∞, –∫–æ–≥–¥–∞ —à—Ç–æ—Ä–º–∏—Ç.");
		  haptic("light");
		});

		$("#titleInput").addEventListener("change", (e) => {
		  state.title = (e.target.value || "").trim() || "–ë–∞–ª–∞–Ω—Å";
		  saveState();
		  renderTitle();
		  toast("‚úÖ", "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ", "–ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞–ª–æ —Ç–≤–æ–∏–º.");
		  haptic("light");
		});

		$("#btnExport").addEventListener("click", () => {
		  const box = $("#exportBox");
		  box.classList.remove("hidden");
		  box.textContent = JSON.stringify(state, null, 2);
		  toast("üì¶", "–≠–∫—Å–ø–æ—Ä—Ç –≥–æ—Ç–æ–≤", "–≠—Ç–æ –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ–±–µ –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å.");
		  haptic("success");
		});

		$("#btnReset").addEventListener("click", () => {
		  const ok = confirm("–°—Ç–µ—Ä–µ—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –ª–æ–∫–∞–ª—å–Ω–æ? –≠—Ç–æ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.");
		  if(!ok) return;
		  state = defaultState();
		  saveState();
		  $("#exportBox").classList.add("hidden");
		  $("#dailyText").textContent = "";
		  $("#weeklyText").textContent = "";
		  toast("ü´ß", "–ì–æ—Ç–æ–≤–æ", "–ß–∏—Å—Ç—ã–π –ª–∏—Å—Ç. –ú—è–≥–∫–æ –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ.");
		  haptic("light");
		  renderAll();
		});

		$("#btnTelegram").addEventListener("click", () => {
		  if(tg){
			const user = tg.initDataUnsafe?.user;
			const name = user?.first_name ? user.first_name : "–¥—Ä—É–≥";
			toast("üí¨", "Telegram –ø–æ–¥–∫–ª—é—á—ë–Ω", `–ü—Ä–∏–≤–µ—Ç, ${name}. –Ø —Ä—è–¥–æ–º üôÇ`);
			haptic("light");
		  } else {
			toast("üåê", "–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –≤ –±—Ä–∞—É–∑–µ—Ä–µ", "–í Telegram –±—É–¥–µ—Ç –µ—â—ë —É—é—Ç–Ω–µ–µ (—Ç–µ–º–∞, sendData).");
			haptic("light");
		  }
		});
	  }

	  // -----------------------------
	  // Init
	  // -----------------------------
	  initTelegram();
	  wireEvents();
	  renderAll();
	  setTab("log");

	  // Small micro-copy rotation (gentle)
	  const micro = [
		"–î–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º? –¢–≤–æ–π –±–∞–ª–∞–Ω—Å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.",
		"–¢—ã –Ω–µ –æ–±—è–∑–∞–Ω(–∞) –±—ã—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–º(–æ–π). –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±—ã—Ç—å —á–µ—Å—Ç–Ω—ã–º(–æ–π).",
		"–û–¥–Ω–æ –Ω–∞–∂–∞—Ç–∏–µ ‚Äî –∏ –≤ –≥–æ–ª–æ–≤–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —á—É—Ç—å –±–æ–ª—å—à–µ —Ç–∏—à–∏–Ω—ã.",
		"–ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è —à—Ç–æ—Ä–º–∏—Ç ‚Äî –º—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–º–µ—á–∞–µ–º –∏ –∏–¥—ë–º –¥–∞–ª—å—à–µ."
	  ];
	  let mi = 0;
	  setInterval(() => {
		mi = (mi + 1) % micro.length;
		$("#microCopy").textContent = micro[mi];
	  }, 6000);
	})();
  </script>
</body>
</html>
