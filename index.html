<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#f7f8f6;
  --card:#ffffff;
  --text:#1c1c1e;
  --muted:#6b6b6f;
  --green:#3cb371;
  --red:#e46a6a;
  --accent:#3a7afe;
  --radius:24px;
}

[data-theme="dark"]{
  --bg:#0f1115;
  --card:#1a1c22;
  --text:#f2f2f3;
  --muted:#9b9ba0;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}
.card{
  background:var(--card);
  border-radius:var(--radius);
}
.btn{
  border-radius:20px;
}
.fade{animation:fade .25s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}
.pulse{
  animation:pulse 4s ease-in-out infinite;
}
@keyframes pulse{
  0%{transform:scale(.85)}
  50%{transform:scale(1)}
  100%{transform:scale(.85)}
}
</style>
</head>

<body class="min-h-screen px-4 pb-28">

<div class="max-w-md mx-auto">

<!-- HEADER -->
<header class="flex items-center gap-3 pt-6 pb-4">
  <div class="w-9 h-9 rounded-full bg-[var(--green)]"></div>
  <h1 class="text-xl font-semibold">–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</h1>
</header>

<!-- ONBOARDING -->
<section id="onboarding" class="card p-5 mb-4 fade">
  <p class="text-sm text-[var(--muted)]">
    –Ø —Ä—è–¥–æ–º. –ü—Ä–æ—Å—Ç–æ –æ—Ç–º–µ—á–∞–π.
  </p>
  <button id="hideOnboarding" class="text-sm text-[var(--accent)] mt-3">
    –ü–æ–Ω—è—Ç–Ω–æ
  </button>
</section>

<!-- TABS -->
<nav class="flex gap-2 mb-4">
  <button data-tab="log" class="tab btn px-4 py-2 bg-[var(--accent)] text-white">–ë–∞–ª–∞–Ω—Å</button>
  <button data-tab="summary" class="tab btn px-4 py-2 bg-[var(--card)]">–ò—Ç–æ–≥–∏</button>
  <button data-tab="breath" class="tab btn px-4 py-2 bg-[var(--card)]">–î—ã—Ö–∞–Ω–∏–µ</button>
  <button data-tab="settings" class="tab btn px-4 py-2 bg-[var(--card)]">‚öôÔ∏è</button>
</nav>

<!-- LOG -->
<section id="tab-log" class="fade">
  <div class="grid gap-4">
    <button id="btnGood" class="card p-6 text-left border border-green-200">
      <div class="text-lg font-semibold text-[var(--green)]">–í –∫–æ–ø–∏–ª–∫—É</div>
      <div class="text-sm text-[var(--muted)]">–ü–æ–ª–µ–∑–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</div>
    </button>

    <button id="btnBad" class="card p-6 text-left border border-red-200">
      <div class="text-lg font-semibold text-[var(--red)]">–ù–∞ –ø–∞—É–∑–µ</div>
      <div class="text-sm text-[var(--muted)]">–®–∞–≥ –≤ —Å—Ç–æ—Ä–æ–Ω—É</div>
    </button>

    <div class="card p-4">
      <div class="flex justify-between items-center mb-2">
        <span class="font-medium">–¢–≤–æ–π —É–∑–æ—Ä —Å–µ–≥–æ–¥–Ω—è</span>
        <button id="clearDay" class="text-sm text-[var(--accent)]">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
      <div id="pattern" class="text-xl"></div>
    </div>
  </div>
</section>

<!-- SUMMARY -->
<section id="tab-summary" class="hidden fade">
  <div class="card p-4 mb-4">
    <pre id="dailySummary" class="text-sm whitespace-pre-wrap"></pre>
    <button id="sendDaily" class="mt-3 text-sm text-[var(--accent)]">
      –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç
    </button>
  </div>

  <div class="card p-4">
    <pre id="weeklySummary" class="text-sm whitespace-pre-wrap"></pre>
    <button id="sendWeekly" class="mt-3 text-sm text-[var(--accent)]">
      –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –±–æ—Ç
    </button>
  </div>
</section>

<!-- BREATH -->
<section id="tab-breath" class="hidden fade text-center">
  <div class="card p-6">
    <div id="breathCircle" class="mx-auto w-40 h-40 rounded-full bg-[var(--accent)] flex items-center justify-center text-white text-lg pulse">
      –í–¥–æ—Ö
    </div>
    <p id="breathText" class="mt-4 text-sm text-[var(--muted)]">
      4 ‚Ä¢ 4 ‚Ä¢ 4 ‚Ä¢ 4
    </p>
  </div>
</section>

<!-- SETTINGS -->
<section id="tab-settings" class="hidden fade">
  <div class="card p-4">
    <p class="text-sm mb-2">–¢–µ–º–∞</p>
    <div class="flex gap-2">
      <button data-theme="light" class="btn px-4 py-2 bg-[var(--card)]">–°–≤–µ—Ç–ª–∞—è</button>
      <button data-theme="dark" class="btn px-4 py-2 bg-[var(--card)]">–¢—ë–º–Ω–∞—è</button>
      <button data-theme="system" class="btn px-4 py-2 bg-[var(--card)]">–°–∏—Å—Ç–µ–º–Ω–∞—è</button>
    </div>
  </div>
</section>

</div>

<script>
const tg = window.Telegram?.WebApp;
tg?.ready();

const STORAGE = "harbor_v2";
let state = JSON.parse(localStorage.getItem(STORAGE)) || {
  hideOnboarding:false,
  theme:"system",
  events:[]
};

const save=()=>localStorage.setItem(STORAGE,JSON.stringify(state));
const today=()=>new Date().toISOString().slice(0,10);

const patternEl=document.getElementById("pattern");

function renderPattern(){
  const e=state.events.filter(x=>x.date===today());
  patternEl.textContent=e.map(x=>x.type==="good"?"üü¢":"üî¥").join("")||"‚Äî";
}

document.getElementById("btnGood").onclick=()=>{
  state.events.push({date:today(),type:"good"});
  save();renderPattern();
};

document.getElementById("btnBad").onclick=()=>{
  state.events.push({date:today(),type:"bad"});
  save();renderPattern();
};

document.getElementById("clearDay").onclick=()=>{
  state.events=state.events.filter(x=>x.date!==today());
  save();renderPattern();
};

document.getElementById("hideOnboarding").onclick=()=>{
  state.hideOnboarding=true;
  document.getElementById("onboarding").remove();
  save();
};

if(state.hideOnboarding){
  document.getElementById("onboarding")?.remove();
}

document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll("section[id^='tab']").forEach(s=>s.classList.add("hidden"));
    document.getElementById("tab-"+btn.dataset.tab).classList.remove("hidden");
  };
});

document.querySelectorAll("[data-theme]").forEach(btn=>{
  btn.onclick=()=>{
    state.theme=btn.dataset.theme;
    save();
    applyTheme();
  };
});

function applyTheme(){
  if(state.theme==="system"){
    document.documentElement.removeAttribute("data-theme");
  }else{
    document.documentElement.setAttribute("data-theme",state.theme);
  }
}
applyTheme();
renderPattern();
</script>

</body>
</html>
