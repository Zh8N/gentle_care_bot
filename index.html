<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#f7f8f6;
  --card:#ffffff;
  --text:#1c1c1e;
  --muted:#6b6b6f;
  --green:#3cb371;
  --red:#e46a6a;
  --accent:#6bbf9a;
  --radius:24px;
}

[data-theme="dark"]{
  --bg:#0f1115;
  --card:#1a1c22;
  --text:#f2f2f3;
  --muted:#9b9ba0;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family: system-ui,-apple-system,BlinkMacSystemFont;
}

.card{background:var(--card);border-radius:var(--radius);}
.btn{border-radius:999px;}
.fade{animation:fade .25s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}

.theme-switch{
  display:flex;
  background:rgba(0,0,0,.05);
  border-radius:999px;
  padding:4px;
  gap:4px;
}
.theme-btn{
  flex:1;
  padding:10px 0;
  border-radius:999px;
  font-size:14px;
  color:var(--muted);
}
.theme-btn.active{
  background:var(--accent);
  color:white;
}

/* breathing */
#breathCircle{
  transition:transform 1s linear, background 1s linear;
  background:radial-gradient(circle at 30% 30%, #8be3b2, #3cb371);
}
</style>
</head>

<body class="min-h-screen px-4 pb-28">

<div class="max-w-md mx-auto">

<!-- HEADER -->
<header class="flex items-center gap-3 pt-6 pb-4">
  <div class="w-10 h-10 rounded-full bg-[var(--accent)] flex items-center justify-center text-white text-lg">üåø</div>
  <h1 class="text-xl font-semibold">–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</h1>
</header>

<!-- TABS -->
<nav class="flex gap-2 mb-4">
  <button data-tab="log" class="tab btn px-4 py-2 bg-[var(--accent)] text-white">–ë–∞–ª–∞–Ω—Å</button>
  <button data-tab="summary" class="tab btn px-4 py-2 bg-[var(--card)]">–ò—Ç–æ–≥–∏</button>
  <button data-tab="breath" class="tab btn px-4 py-2 bg-[var(--card)]">–î—ã—Ö–∞–Ω–∏–µ</button>
  <button data-tab="settings" class="tab btn px-4 py-2 bg-[var(--card)]">‚öôÔ∏è</button>
</nav>

<!-- LOG -->
<section id="tab-log">
  <div class="grid gap-4">
    <button id="btnGood" class="card p-6 border border-green-200">
      <div class="text-lg font-semibold text-[var(--green)]">üü¢ –í –∫–æ–ø–∏–ª–∫—É</div>
    </button>
    <button id="btnBad" class="card p-6 border border-red-200">
      <div class="text-lg font-semibold text-[var(--red)]">üî¥ –ù–∞ –ø–∞—É–∑–µ</div>
    </button>
    <div class="card p-4">
      <div class="flex justify-between mb-2">
        <span>–°–µ–≥–æ–¥–Ω—è</span>
        <button id="clearDay" class="text-sm text-[var(--accent)]">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
      <div id="pattern" class="text-xl">‚Äî</div>
    </div>
  </div>
</section>

<!-- SUMMARY -->
<section id="tab-summary" class="hidden">
  <div class="card p-4 mb-4">
    <pre id="dailySummary" class="text-sm whitespace-pre-wrap"></pre>
  </div>
  <div class="card p-4">
    <pre id="weeklySummary" class="text-sm whitespace-pre-wrap"></pre>
  </div>
</section>

<!-- BREATH -->
<section id="tab-breath" class="hidden text-center">
  <div class="card p-6">
    <div id="breathCircle" class="mx-auto w-40 h-40 rounded-full flex items-center justify-center text-white text-lg">
      –í–¥–æ—Ö
    </div>
    <p id="breathText" class="mt-4 text-sm text-[var(--muted)]">4 ‚Ä¢ 4 ‚Ä¢ 4 ‚Ä¢ 4</p>
  </div>
</section>

<!-- SETTINGS -->
<section id="tab-settings" class="hidden">
  <div class="card p-4">
    <p class="text-sm mb-2">–¢–µ–º–∞</p>
    <div class="theme-switch">
      <button data-theme="light" class="theme-btn">‚òÄÔ∏è</button>
      <button data-theme="dark" class="theme-btn">üåô</button>
      <button data-theme="system" class="theme-btn">‚öôÔ∏è</button>
    </div>
  </div>
</section>

</div>

<script>
const STORAGE="harbor_v3";
const state=JSON.parse(localStorage.getItem(STORAGE))||{theme:"system",events:[]};
const save=()=>localStorage.setItem(STORAGE,JSON.stringify(state));
const today=()=>new Date().toISOString().slice(0,10);

const pattern=document.getElementById("pattern");

function render(){
  const t=state.events.filter(e=>e.date===today());
  pattern.textContent=t.map(e=>e.type==="good"?"üü¢":"üî¥").join("")||"‚Äî";

  document.getElementById("dailySummary").textContent=
`üåô –ò—Ç–æ–≥–∏ –¥–Ω—è
${pattern.textContent}
–ë–∞–ª–∞–Ω—Å: ${t.filter(e=>e.type==="good").length - t.filter(e=>e.type==="bad").length}`;

  document.getElementById("weeklySummary").textContent=
`‚ú® –ò—Ç–æ–≥–∏ –Ω–µ–¥–µ–ª–∏
–í—Å–µ–≥–æ –æ—Ç–º–µ—Ç–æ–∫: ${state.events.length}`;
}

document.getElementById("btnGood").onclick=()=>{state.events.push({date:today(),type:"good"});save();render();}
document.getElementById("btnBad").onclick=()=>{state.events.push({date:today(),type:"bad"});save();render();}
document.getElementById("clearDay").onclick=()=>{state.events=state.events.filter(e=>e.date!==today());save();render();}

document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll("section[id^='tab']").forEach(s=>s.classList.add("hidden"));
    document.getElementById("tab-"+btn.dataset.tab).classList.remove("hidden");
  };
});

/* theme */
function applyTheme(){
  document.querySelectorAll(".theme-btn").forEach(b=>b.classList.toggle("active",b.dataset.theme===state.theme));
  state.theme==="system"?document.documentElement.removeAttribute("data-theme"):
  document.documentElement.setAttribute("data-theme",state.theme);
}
document.querySelectorAll(".theme-btn").forEach(b=>b.onclick=()=>{state.theme=b.dataset.theme;save();applyTheme();});
applyTheme();

/* breathing */
const circle=document.getElementById("breathCircle");
const text=document.getElementById("breathText");
const phases=[
  ["–í–¥–æ—Ö",4,0.75,1],
  ["–ü–∞—É–∑–∞",4,1,1],
  ["–í—ã–¥–æ—Ö",4,1,0.75],
  ["–ü–∞—É–∑–∞",4,0.75,0.75]
];
let timer=null,sec=0,p=0,total=0;

function startBreath(){
  stopBreath();sec=0;p=0;total=0;
  timer=setInterval(()=>{
    const [label,dur,from,to]=phases[p];
    const k=sec/dur;
    circle.style.transform=`scale(${from+(to-from)*k})`;
    circle.textContent=label;
    text.textContent=`${label} ${sec+1}/4`;
    sec++;total++;
    if(sec>=dur){sec=0;p=(p+1)%4;}
    if(total>=60)stopBreath();
  },1000);
}
function stopBreath(){if(timer)clearInterval(timer);timer=null;}

document.querySelector("[data-tab='breath']").onclick=startBreath;
document.querySelectorAll("[data-tab]").forEach(b=>b.dataset.tab!=="breath"&&b.addEventListener("click",stopBreath));

render();
</script>

</body>
</html>
