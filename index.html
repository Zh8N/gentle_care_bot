<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Balance Care</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    /* === –°–¢–ò–õ–ò –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô (–∫–∞–∫ —É —Ç–µ–±—è) === */
    /* —è –∏—Ö –Ω–µ —Ç—Ä–æ–≥–∞—é, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ —Å–ª–æ–º–∞—Ç—å */
  </style>
</head>

<body>
  <div class="app-wrap max-w-md mx-auto px-4">

    <!-- TODAY -->
    <section id="tab-today">
      <div class="card p-4 mb-4">
        <div class="text-base font-semibold">–û—Ç–º–µ—Ç–∏—Ç—å –º–æ–º–µ–Ω—Ç</div>
        <div class="small-muted">–û–¥–∏–Ω —à–∞–≥ ‚Äî —É–∂–µ –¥–≤–∏–∂–µ–Ω–∏–µ.</div>
      </div>

      <div class="grid gap-3 mb-3">
        <button id="btnGood" class="action-btn action-primary">–°–¥–µ–ª–∞–ª–∞ –ø–æ–ª–µ–∑–Ω–æ–µ</button>
        <button id="btnPause" class="action-btn action-neutral">–°–¥–µ–ª–∞–ª–∞ –ø–∞—É–∑—É</button>
      </div>

      <!-- üîπ –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê -->
      <button id="btnTag" class="ghost-btn w-full mb-4">
        ‚úçÔ∏è –•–æ—á–µ—à—å –∫–æ—Ä–æ—Ç–∫–æ –æ—Ç–º–µ—Ç–∏—Ç—å, –ø—Ä–æ —á—Ç–æ —ç—Ç–æ –±—ã–ª–æ?
      </button>

      <div class="card p-4">
        <div class="text-sm font-semibold mb-2">–°–µ–≥–æ–¥–Ω—è</div>
        <div id="todayDots" class="dot-row"></div>
      </div>
    </section>

    <!-- SUMMARY -->
    <section id="tab-summary" class="hidden">
      <div class="card p-4">
        <div class="text-base font-semibold mb-2">–ò—Ç–æ–≥–∏ –¥–Ω—è</div>
        <div id="summaryAreas" class="small-muted mt-2"></div>
      </div>
    </section>

    <!-- MODAL -->
    <div id="areaModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
      <div class="card p-4 w-[90%] max-w-sm">
        <div class="text-base font-semibold mb-2">
          –ü—Ä–æ —á—Ç–æ —ç—Ç–æ –±—ã–ª–æ?
        </div>

        <div class="grid gap-2">
          <button class="ghost-btn" data-area="mind">üß† –ú—ã—Å–ª–∏ / —ç–º–æ—Ü–∏–∏</button>
          <button class="ghost-btn" data-area="body">üçΩ –¢–µ–ª–æ / –µ–¥–∞</button>
          <button class="ghost-btn" data-area="energy">üõå –≠–Ω–µ—Ä–≥–∏—è / —É—Å—Ç–∞–ª–æ—Å—Ç—å</button>
          <button class="ghost-btn" data-area="relations">ü§ç –û—Ç–Ω–æ—à–µ–Ω–∏—è / –≥—Ä–∞–Ω–∏—Ü—ã</button>
          <button class="ghost-btn" data-area="skip">‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

<script>
(() => {
  const STORAGE = "balancecare_v_area";
  let state = JSON.parse(localStorage.getItem(STORAGE)) || { events: [] };

  const $ = s => document.querySelector(s);
  const $$ = s => Array.from(document.querySelectorAll(s));

  function save(){
    localStorage.setItem(STORAGE, JSON.stringify(state));
  }

  function today(){
    const d = new Date();
    return d.toISOString().slice(0,10);
  }

  function addEvent(type){
    state.events.push({
      ts: new Date().toISOString(),
      date: today(),
      type,
      area: null
    });
    save();
    render();
  }

  function lastEvent(){
    return state.events[state.events.length - 1];
  }

  function render(){
    const dots = $("#todayDots");
    dots.innerHTML = "";
    state.events.filter(e => e.date === today()).forEach(e => {
      const d = document.createElement("div");
      d.className = "dot " + (e.type === "good" ? "good" : "pause");
      dots.appendChild(d);
    });

    // summary areas
    const areas = {};
    state.events.filter(e => e.date === today() && e.area)
      .forEach(e => areas[e.area] = (areas[e.area] || 0) + 1);

    const box = $("#summaryAreas");
    if(Object.keys(areas).length === 0){
      box.textContent = "–°–µ–≥–æ–¥–Ω—è –±–µ–∑ –æ—Ç–º–µ—Ç–æ–∫ –ø–æ –æ–±–ª–∞—Å—Ç—è–º ‚Äî –∏ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.";
    } else {
      box.innerHTML = "–û–±–ª–∞—Å—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è:<br>" +
        Object.entries(areas)
          .map(([k,v]) => `‚Ä¢ ${k} ‚Äî ${v}`)
          .join("<br>");
    }
  }

  $("#btnGood").onclick = () => addEvent("good");
  $("#btnPause").onclick = () => addEvent("pause");

  $("#btnTag").onclick = () => {
    if(!lastEvent()){
      alert("–°–Ω–∞—á–∞–ª–∞ –æ—Ç–º–µ—Ç—å –º–æ–º–µ–Ω—Ç üü¶ –∏–ª–∏ ‚óªÔ∏è");
      return;
    }
    $("#areaModal").classList.remove("hidden");
    $("#areaModal").classList.add("flex");
  };

  $$("#areaModal [data-area]").forEach(btn => {
    btn.onclick = () => {
      const area = btn.dataset.area;
      if(area !== "skip"){
        lastEvent().area = area;
        save();
      }
      $("#areaModal").classList.add("hidden");
      $("#areaModal").classList.remove("flex");
      render();
    };
  });

  render();
})();
</script>
</body>
</html>
