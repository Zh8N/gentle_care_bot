<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>–ë–∞–ª–∞–Ω—Å</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#f7f8f6;
  --card:#ffffff;
  --text:#1c1c1e;
  --muted:#7a7a80;
  --green:#7fb7a0;
  --pause:#c9b8b2;
  --accent:#5f8cff;
  --radius:22px;
}

[data-theme="dark"]{
  --bg:#0f1115;
  --card:#1a1c22;
  --text:#f2f2f3;
  --muted:#9b9ba0;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
}

.tab{
  padding:6px 10px;
  font-size:14px;
  color:var(--muted);
}

.tab.active{
  color:var(--text);
  border-bottom:2px solid var(--text);
}

.fade{animation:fade .25s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}

</style>
</head>

<body class="min-h-screen px-4 pb-28">

<div class="max-w-md mx-auto">

<!-- TABS -->
<nav class="flex gap-5 pt-6 pb-4">
  <button data-tab="log" class="tab active">–°–µ–≥–æ–¥–Ω—è</button>
  <button data-tab="summary" class="tab">–ò—Ç–æ–≥–∏</button>
  <button data-tab="breath" class="tab">–î—ã—Ö–∞–Ω–∏–µ</button>
  <button data-tab="settings" class="tab">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
</nav>

<!-- TODAY -->
<section id="tab-log" class="fade">
  <div class="grid gap-4">

    <button id="btnGood" class="card p-6 text-left" style="background:#eef6f2">
      <div class="text-lg font-medium">‚ûï –°–¥–µ–ª–∞–ª–∞ –ø–æ–ª–µ–∑–Ω–æ–µ</div>
    </button>

    <button id="btnBad" class="card p-6 text-left" style="background:#f3efee">
      <div class="text-lg font-medium">‚è∏ –°–¥–µ–ª–∞–ª–∞ –ø–∞—É–∑—É</div>
    </button>

    <div class="card p-4">
      <div class="text-sm mb-2">–°–µ–≥–æ–¥–Ω—è</div>
      <div id="pattern" class="text-xl"></div>
    </div>

  </div>
</section>

<!-- SUMMARY -->
<section id="tab-summary" class="hidden fade">
  <div class="card p-4">
    <div id="summaryPattern" class="text-xl mb-3"></div>
    <div id="summaryPhrase" class="text-sm text-[var(--muted)]"></div>
  </div>
</section>

<!-- BREATH -->
<section id="tab-breath" class="hidden fade text-center">
  <div class="card p-6">
    <div id="breathCircle"
      class="mx-auto w-40 h-40 rounded-full flex items-center justify-center text-white text-lg"
      style="background:radial-gradient(circle at top,#8fb8ff,#5f8cff)">
      –í–¥–æ—Ö
    </div>
    <div id="breathText" class="mt-4 text-sm text-[var(--muted)]"></div>
  </div>
</section>

<!-- SETTINGS -->
<section id="tab-settings" class="hidden fade">
  <div class="card p-4">
    <div class="text-sm mb-2">–¢–µ–º–∞</div>
    <div class="flex gap-2">
      <button data-theme="light">–°–≤–µ—Ç–ª–∞—è</button>
      <button data-theme="dark">–¢—ë–º–Ω–∞—è</button>
      <button data-theme="system">–°–∏—Å—Ç–µ–º–Ω–∞—è</button>
    </div>
  </div>
</section>

</div>

<script>
const tg = window.Telegram?.WebApp;
tg?.ready();

const STORAGE="balance_final";
let state=JSON.parse(localStorage.getItem(STORAGE))||{events:[],theme:"system"};
const save=()=>localStorage.setItem(STORAGE,JSON.stringify(state));
const today=()=>new Date().toISOString().slice(0,10);

const phrases={
  good:[
    "–°–µ–≥–æ–¥–Ω—è –º–Ω–æ–≥–æ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–æ.",
    "–í —ç—Ç–æ–º –¥–Ω–µ –±—ã–ª–æ –Ω–∞ —á—Ç–æ –æ–ø–µ—Ä–µ—Ç—å—Å—è.",
    "–î–µ–Ω—å –¥–µ—Ä–∂–∞–ª—Å—è —Ä–æ–≤–Ω–æ."
  ],
  mixed:[
    "–î–µ–Ω—å –ø–æ–ª—É—á–∏–ª—Å—è —Ä–∞–∑–Ω—ã–º.",
    "–°–µ–≥–æ–¥–Ω—è –±—ã–ª–æ –ø–æ-—Ä–∞–∑–Ω–æ–º—É.",
    "–ú–Ω–æ–≥–æ –≤—Å–µ–≥–æ –≤–ø–µ—Ä–µ–º–µ—à–∫—É."
  ],
  pause:[
    "–î–µ–Ω—å –±—ã–ª –Ω–µ–ø—Ä–æ—Å—Ç—ã–º, –Ω–æ –∂–∏–≤—ã–º.",
    "–†–∏—Ç–º —Å–µ–≥–æ–¥–Ω—è —Å–±–∏–≤–∞–ª—Å—è.",
    "–ò–Ω–æ–≥–¥–∞ —Ç–∞–∫ –∏ –∏–¥—ë—Ç."
  ],
  empty:[
    "–°–µ–≥–æ–¥–Ω—è –±—ã–ª–æ —Å–ø–æ–∫–æ–π–Ω–æ.",
    "–î–µ–Ω—å –ø—Ä–æ—à—ë–ª —Ç–∏—Ö–æ.",
    "–ò–Ω–æ–≥–¥–∞ –¥–µ–Ω—å –ø—Ä–æ—Å—Ç–æ –∏–¥—ë—Ç."
  ]
};

function render(){
  const events=state.events.filter(e=>e.date===today());
  document.getElementById("pattern").textContent=
    events.map(e=>e.type==="good"?"üü¢":"üü†").join("")||"‚Äî";

  document.getElementById("summaryPattern").textContent=
    events.map(e=>e.type==="good"?"üü¢":"üü†").join("")||"‚Äî";

  const phraseEl=document.getElementById("summaryPhrase");
  phraseEl.textContent="";

  if(Math.random()<0.35){
    let pool="empty";
    const g=events.filter(e=>e.type==="good").length;
    const p=events.filter(e=>e.type==="pause").length;
    if(events.length){
      pool=g>p?"good":p>g?"pause":"mixed";
    }
    phraseEl.textContent=
      phrases[pool][Math.floor(Math.random()*phrases[pool].length)];
  }
}

document.getElementById("btnGood").onclick=()=>{
  state.events.push({date:today(),type:"good"});save();render();
};
document.getElementById("btnBad").onclick=()=>{
  state.events.push({date:today(),type:"pause"});save();render();
};

document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll("section[id^='tab']").forEach(s=>s.classList.add("hidden"));
    document.getElementById("tab-"+btn.dataset.tab).classList.remove("hidden");
  };
});

/* BREATHING */
let breathTimer,stopTimer;
const circle=document.getElementById("breathCircle");
const text=document.getElementById("breathText");
const phases=[
  ["–í–¥–æ—Ö",4,0.8,1],
  ["–ü–∞—É–∑–∞",4,1,1],
  ["–í—ã–¥–æ—Ö",4,1,0.8],
  ["–ü–∞—É–∑–∞",4,0.8,0.8]
];

function startBreath(){
  let p=0,s=0;
  circle.style.transform="scale(0.8)";
  breathTimer=setInterval(()=>{
    const [label,d,a,b]=phases[p];
    const k=s/d;
    circle.textContent=label;
    circle.style.transform=`scale(${a+(b-a)*k})`;
    text.textContent=label+" "+(s+1);
    s++;
    if(s>=d){s=0;p=(p+1)%4;}
  },1000);
  stopTimer=setTimeout(stopBreath,60000);
}

function stopBreath(){
  clearInterval(breathTimer);
  clearTimeout(stopTimer);
}

document.querySelector("[data-tab='breath']").onclick=startBreath;
document.querySelectorAll("[data-tab]").forEach(b=>{
  if(b.dataset.tab!=="breath")b.onclick=stopBreath;
});

render();
</script>

</body>
</html>
