<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#f7f8f6;
  --card:#ffffff;
  --text:#1c1c1e;
  --muted:#6b6b6f;
  --green:#3cb371;
  --red:#e46a6a;
  --accent:#3a7afe;
  --radius:24px;
}

[data-theme="dark"]{
  --bg:#0f1115;
  --card:#1a1c22;
  --text:#f2f2f3;
  --muted:#9b9ba0;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

.card{
  background:var(--card);
  border-radius:var(--radius);
}

.btn{
  border-radius:20px;
}

.fade{animation:fade .25s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}

#breathCircle{
  background: radial-gradient(
    circle at 30% 30%,
    rgba(255,255,255,0.35),
    rgba(58,122,254,0.9) 45%,
    rgba(40,90,200,1) 75%
  );
}
</style>
</head>

<body class="min-h-screen px-4 pb-28">
<div class="max-w-md mx-auto">

<header class="flex items-center gap-3 pt-6 pb-4">
  <div class="w-9 h-9 rounded-full bg-[var(--green)]"></div>
  <h1 class="text-xl font-semibold">–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</h1>
</header>

<section id="onboarding" class="card p-5 mb-4 fade">
  <p class="text-sm text-[var(--muted)]">–Ø —Ä—è–¥–æ–º. –ü—Ä–æ—Å—Ç–æ –æ—Ç–º–µ—á–∞–π.</p>
  <button id="hideOnboarding" class="text-sm text-[var(--accent)] mt-3">–ü–æ–Ω—è—Ç–Ω–æ</button>
</section>

<nav class="flex gap-2 mb-4">
  <button data-tab="log" class="tab btn px-4 py-2 bg-[var(--accent)] text-white">–ë–∞–ª–∞–Ω—Å</button>
  <button data-tab="summary" class="tab btn px-4 py-2 bg-[var(--card)]">–ò—Ç–æ–≥–∏</button>
  <button data-tab="breath" class="tab btn px-4 py-2 bg-[var(--card)]">–î—ã—Ö–∞–Ω–∏–µ</button>
  <button data-tab="settings" class="tab btn px-4 py-2 bg-[var(--card)]">‚öôÔ∏è</button>
</nav>

<section id="tab-log" class="fade">
  <div class="grid gap-4">
    <button id="btnGood" class="card p-6 text-left border border-green-200">
      <div class="text-lg font-semibold text-[var(--green)]">–í –∫–æ–ø–∏–ª–∫—É</div>
      <div class="text-sm text-[var(--muted)]">–ü–æ–ª–µ–∑–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ</div>
    </button>

    <button id="btnBad" class="card p-6 text-left border border-red-200">
      <div class="text-lg font-semibold text-[var(--red)]">–ù–∞ –ø–∞—É–∑–µ</div>
      <div class="text-sm text-[var(--muted)]">–®–∞–≥ –≤ —Å—Ç–æ—Ä–æ–Ω—É</div>
    </button>

    <div class="card p-4">
      <div class="flex justify-between items-center mb-2">
        <span class="font-medium">–¢–≤–æ–π —É–∑–æ—Ä —Å–µ–≥–æ–¥–Ω—è</span>
        <button id="clearDay" class="text-sm text-[var(--accent)]">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
      <div id="pattern" class="text-xl"></div>
    </div>
  </div>
</section>

<section id="tab-summary" class="hidden fade">
  <div class="card p-4">
    <pre id="dailySummary" class="text-sm whitespace-pre-wrap">–ò—Ç–æ–≥–∏ –ø–æ—è–≤—è—Ç—Å—è –ø–æ–∑–∂–µ üåô</pre>
  </div>
</section>

<section id="tab-breath" class="hidden fade text-center">
  <div class="card p-6">
    <div id="breathCircle"
      class="mx-auto w-40 h-40 rounded-full flex items-center justify-center text-white text-lg">
      –í–¥–æ—Ö
    </div>
    <p id="breathText" class="mt-4 text-sm text-[var(--muted)]">–ì–æ—Ç–æ–≤–∏–º—Å—è‚Ä¶</p>
  </div>
</section>

<section id="tab-settings" class="hidden fade">
  <div class="card p-4">
    <p class="text-sm mb-2">–¢–µ–º–∞</p>
    <div class="flex gap-2">
      <button data-theme="light" class="btn px-4 py-2 bg-[var(--card)]">–°–≤–µ—Ç–ª–∞—è</button>
      <button data-theme="dark" class="btn px-4 py-2 bg-[var(--card)]">–¢—ë–º–Ω–∞—è</button>
      <button data-theme="system" class="btn px-4 py-2 bg-[var(--card)]">–°–∏—Å—Ç–µ–º–Ω–∞—è</button>
    </div>
  </div>
</section>

</div>

<script>
const STORAGE="harbor_v3";
let state=JSON.parse(localStorage.getItem(STORAGE))||{hideOnboarding:false,theme:"system",events:[]};
const save=()=>localStorage.setItem(STORAGE,JSON.stringify(state));
const today=()=>new Date().toISOString().slice(0,10);

if(state.hideOnboarding)document.getElementById("onboarding")?.remove();
document.getElementById("hideOnboarding").onclick=()=>{state.hideOnboarding=true;save();location.reload();};

const pattern=document.getElementById("pattern");
const renderPattern=()=>{
  const e=state.events.filter(x=>x.date===today());
  pattern.textContent=e.map(x=>x.type==="good"?"üü¢":"üî¥").join("")||"‚Äî";
};
renderPattern();

btnGood.onclick=()=>{state.events.push({date:today(),type:"good"});save();renderPattern();};
btnBad.onclick=()=>{state.events.push({date:today(),type:"bad"});save();renderPattern();};
clearDay.onclick=()=>{state.events=state.events.filter(x=>x.date!==today());save();renderPattern();};

document.querySelectorAll(".tab").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll("section[id^='tab']").forEach(s=>s.classList.add("hidden"));
    document.getElementById("tab-"+btn.dataset.tab).classList.remove("hidden");
    if(btn.dataset.tab==="breath")startBreathing(); else stopBreathing();
  };
});

let timer=null,total=0,phase=0,sec=0;
const phases=[
  ["–í–¥–æ—Ö",0.75,1],
  ["–ü–∞—É–∑–∞",1,1],
  ["–í—ã–¥–æ—Ö",1,0.75],
  ["–ü–∞—É–∑–∞",0.75,0.75]
];

function startBreathing(){
  stopBreathing();
  total=0;phase=0;sec=0;
  timer=setInterval(()=>{
    const [label,from,to]=phases[phase];
    const scale=from+(to-from)*(sec/4);
    breathCircle.style.transform=`scale(${scale})`;
    breathCircle.style.transition="transform 1s linear";
    breathText.textContent=`${label} ${sec+1}/4`;
    breathCircle.textContent=label;
    sec++; total++;
    if(sec>=4){sec=0;phase=(phase+1)%4;}
    if(total>=60){stopBreathing();breathCircle.textContent="–ì–æ—Ç–æ–≤–æ";breathText.textContent="–ú–æ–∂–Ω–æ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ üåø";}
  },1000);
}

function stopBreathing(){if(timer){clearInterval(timer);timer=null;}}
renderPattern();
</script>
</body>
</html>
