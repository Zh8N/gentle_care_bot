<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
<title>–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root{
  --bg:#f7f8f6;
  --card:#ffffff;
  --text:#1c1c1e;
  --muted:#6b6b6f;
  --accent:#6bbf9a;
  --green:#3cb371;
  --red:#e46a6a;
  --radius:24px;
}

[data-theme="dark"]{
  --bg:#0f1115;
  --card:#1a1c22;
  --text:#f2f2f3;
  --muted:#9b9ba0;
}

body{
  background:var(--bg);
  color:var(--text);
  font-family: system-ui,-apple-system,BlinkMacSystemFont;
}

.card{background:var(--card);border-radius:var(--radius);}
.fade{animation:fade .25s ease}
@keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1}}

.tab-btn{
  padding:10px 16px;
  border-radius:999px;
  font-size:14px;
  background:var(--card);
  color:var(--muted);
}
.tab-btn.active{
  background:var(--accent);
  color:white;
}

/* breathing */
#breathCircle{
  width:160px;height:160px;
  border-radius:50%;
  margin:auto;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-size:18px;
  background:radial-gradient(circle at 30% 30%, #8be3b2, #3cb371);
  transform:scale(0.75);
  transition:transform 1s linear;
}
</style>
</head>

<body class="min-h-screen px-4 pb-28">

<div class="max-w-md mx-auto">

<header class="flex items-center gap-3 pt-6 pb-4">
  <div class="w-10 h-10 rounded-full bg-[var(--accent)] flex items-center justify-center text-white">üåø</div>
  <h1 class="text-xl font-semibold">–¢–∏—Ö–∞—è –ì–∞–≤–∞–Ω—å</h1>
</header>

<nav class="flex gap-2 mb-4">
  <button data-tab="log" class="tab-btn active">–ë–∞–ª–∞–Ω—Å</button>
  <button data-tab="summary" class="tab-btn">–ò—Ç–æ–≥–∏</button>
  <button data-tab="breath" class="tab-btn">–î—ã—Ö–∞–Ω–∏–µ</button>
  <button data-tab="settings" class="tab-btn">‚öôÔ∏è</button>
</nav>

<section id="tab-log" class="fade">
  <div class="grid gap-4">
    <button id="btnGood" class="card p-6 border border-green-200 text-[var(--green)]">üü¢ –í –∫–æ–ø–∏–ª–∫—É</button>
    <button id="btnBad" class="card p-6 border border-red-200 text-[var(--red)]">üî¥ –ù–∞ –ø–∞—É–∑–µ</button>
    <div class="card p-4">
      <div class="flex justify-between">
        <span>–°–µ–≥–æ–¥–Ω—è</span>
        <button id="clearDay" class="text-sm text-[var(--accent)]">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
      <div id="pattern" class="text-xl mt-2">‚Äî</div>
    </div>
  </div>
</section>

<section id="tab-summary" class="hidden fade">
  <div class="card p-4 mb-4"><pre id="dailySummary"></pre></div>
  <div class="card p-4"><pre id="weeklySummary"></pre></div>
</section>

<section id="tab-breath" class="hidden fade text-center">
  <div class="card p-6">
    <div id="breathCircle">–í–¥–æ—Ö</div>
    <p id="breathText" class="mt-4 text-sm text-[var(--muted)]">4 ‚Ä¢ 4 ‚Ä¢ 4 ‚Ä¢ 4</p>
  </div>
</section>

<section id="tab-settings" class="hidden fade">
  <div class="card p-4">
    <p class="mb-2 text-sm">–¢–µ–º–∞</p>
    <div class="flex gap-2">
      <button data-theme="light">‚òÄÔ∏è</button>
      <button data-theme="dark">üåô</button>
      <button data-theme="system">‚öôÔ∏è</button>
    </div>
  </div>
</section>

</div>

<script>
const STORAGE="harbor_fixed";
const state=JSON.parse(localStorage.getItem(STORAGE))||{events:[],theme:"system"};
const save=()=>localStorage.setItem(STORAGE,JSON.stringify(state));
const today=()=>new Date().toISOString().slice(0,10);

const pattern=document.getElementById("pattern");

function render(){
  const e=state.events.filter(x=>x.date===today());
  pattern.textContent=e.map(x=>x.type==="good"?"üü¢":"üî¥").join("")||"‚Äî";
  dailySummary.textContent=`üåô –ò—Ç–æ–≥–∏ –¥–Ω—è\n${pattern.textContent}`;
  weeklySummary.textContent=`‚ú® –í—Å–µ–≥–æ –æ—Ç–º–µ—Ç–æ–∫: ${state.events.length}`;
}

btnGood.onclick=()=>{state.events.push({date:today(),type:"good"});save();render();}
btnBad.onclick=()=>{state.events.push({date:today(),type:"bad"});save();render();}
clearDay.onclick=()=>{state.events=state.events.filter(x=>x.date!==today());save();render();}

/* tabs */
document.querySelectorAll("[data-tab]").forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll(".tab-btn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    document.querySelectorAll("section[id^='tab']").forEach(s=>s.classList.add("hidden"));
    document.getElementById("tab-"+btn.dataset.tab).classList.remove("hidden");
    if(btn.dataset.tab==="breath") startBreathing();
    else stopBreathing();
  };
});

/* breathing */
const circle=document.getElementById("breathCircle");
const text=document.getElementById("breathText");
const phases=[
  ["–í–¥–æ—Ö",4,0.75,1],
  ["–ü–∞—É–∑–∞",4,1,1],
  ["–í—ã–¥–æ—Ö",4,1,0.75],
  ["–ü–∞—É–∑–∞",4,0.75,0.75]
];
let timer=null,sec=0,p=0,total=0;

function startBreathing(){
  stopBreathing();sec=0;p=0;total=0;
  timer=setInterval(()=>{
    const [label,dur,from,to]=phases[p];
    const k=sec/dur;
    circle.style.transform=`scale(${from+(to-from)*k})`;
    circle.textContent=label;
    text.textContent=`${label} ${sec+1}/4`;
    sec++;total++;
    if(sec>=dur){sec=0;p=(p+1)%4;}
    if(total>=60)stopBreathing();
  },1000);
}
function stopBreathing(){if(timer){clearInterval(timer);timer=null;}}

render();
</script>

</body>
</html>
